<!DOCTYPE html>
<html>
<head>
    <title>SIEM Miniature Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        h2 { margin-bottom: 20px; }
        canvas { margin-bottom: 50px; }
    </style>
</head>
<body>
    <h2>üìä SIEM Miniature Dashboard</h2>

    <!-- ÏãúÍ∞ÑÎ≥Ñ Ïù¥Î≤§Ìä∏ Ï∞®Ìä∏ -->
    <div style="width:80%;">
        <canvas id="eventsOverTime"></canvas>
    </div>

    <!-- IPÎ≥Ñ Ïù¥Î≤§Ìä∏ Ï∞®Ìä∏ -->
    <div style="width:80%;">
        <canvas id="eventsByIP"></canvas>
    </div>

    <!-- Ïù¥ÏÉÅÌÉêÏßÄ Í≤∞Í≥º Î¶¨Ïä§Ìä∏ -->
    <div style="margin-top:40px;">
        <h3>üö® Anomaly Detection Results</h3>
        <ul id="anomalyList"></ul>
    </div>

    <script>
        // FlaskÏóêÏÑú Ï†ÑÎã¨Îêú Îç∞Ïù¥ÌÑ∞
        const timestamps = {{ timestamps|tojson }};
        const eventTypes = {{ event_types|tojson }};
        const ipAddresses = {{ ip_addresses|tojson }};
        const anomalies = {{ anomalies|tojson }};

        // ÏãúÍ∞ÑÎåÄÎ≥Ñ Ïù¥Î≤§Ìä∏ ÏßëÍ≥Ñ
        const timeCount = {};
        timestamps.forEach(ts => {
            timeCount[ts] = (timeCount[ts] || 0) + 1;
        });


        //  IPÎ≥Ñ Ïù¥Î≤§Ìä∏ ÏßëÍ≥Ñ
        const ipCount = {};
        ipAddresses.forEach(ip => {
            ipCount[ip] = (ipCount[ip] || 0) + 1;
        });

 
        //  Anomaly Í≤∞Í≥º Îß§Ìïë

        const anomalyMap = {};
        anomalies.forEach(row => {
            anomalyMap[row.ip] = row.anomaly;
        });

  
        // Chart.js: ÏãúÍ∞ÑÎ≥Ñ Ïù¥Î≤§Ìä∏ (Line)
        new Chart(document.getElementById("eventsOverTime"), {
            type: "line",
            data: {
                labels: Object.keys(timeCount),
                datasets: [{
                    label: "Events over time",
                    data: Object.values(timeCount),
                    borderColor: "red",
                    backgroundColor: "rgba(255,0,0,0.2)",
                    fill: true,
                    tension: 0.2
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: "top" } },
                scales: { x: { title: { display: true, text: "Time" } },
                          y: { title: { display: true, text: "Event Count" } } }
            }
        });


        // Chart.js: IPÎ≥Ñ Ïù¥Î≤§Ìä∏ (Bar)
        new Chart(document.getElementById("eventsByIP"), {
            type: "bar",
            data: {
                labels: Object.keys(ipCount),
                datasets: [{
                    label: "Events per IP",
                    data: Object.values(ipCount),
                    backgroundColor: Object.keys(ipCount).map(ip =>
                        anomalyMap[ip] === -1 ? "red" : "blue"
                    )
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: { x: { title: { display: true, text: "IP Address" } },
                          y: { title: { display: true, text: "Event Count" } } }
            }
        });


        // HTML Î™©Î°ùÏúºÎ°ú Anomaly ÌëúÏãú
        const anomalyList = document.getElementById("anomalyList");
        anomalies.forEach(row => {
            const li = document.createElement("li");
            li.textContent = `IP: ${row.ip}, Fail Count: ${row.fail_count}, Status: ${row.anomaly === -1 ? "‚ö†Ô∏è Suspicious" : "‚úÖ Normal"}`;
            if (row.anomaly === -1) {
                li.style.color = "red";
                li.style.fontWeight = "bold";
            } else {
                li.style.color = "blue";
            }
            anomalyList.appendChild(li);
        });
    </script>
</body>
</html>
